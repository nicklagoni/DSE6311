---
title: "Model Evaluation"
author: "Nick Lagoni"
date: "`r Sys.Date()`"
output: html_document
---
# Setup
```{r}
Sys.setenv(lang='en')
set.seed(42)
library(readr)
library(tidyverse)
library(dplyr)
library(purrr)
library(ggplot2)
library(GGally)
library(corrplot)
library(reshape2)
library(patchwork)
library(e1071)
library(gt)
library(magick)
library(vegan)
library(rsample)
library(randomForest)
library(janitor)
```

# Data Import and Cleaning
```{r}
transects<-read.csv("transects.csv")
motileInvert_counts<-read.csv("motileInvert_counts.csv")
motileInvert_measurements<-read.csv("motileInvert_measurements.csv")
photoquadrats<-read.csv("photoquadrats.csv")

#Photoplots Pivot
photoquadrats_pivot<-photoquadrats%>%
  select(Site_Name,Loc_Name,Target_Species,Plot_Name,Start_Date,Spp_Name,Perc_Cover)%>%
  pivot_wider(
    names_from = Spp_Name,
    values_from = Perc_Cover,
    values_fn = mean
  )
#Motile Invert Counts Pivot
motileInvert_counts$Count<-motileInvert_counts$Damage+motileInvert_counts$No.Damage
motileInvert_counts_pivot<-motileInvert_counts%>%
  select(Site_Name,Loc_Name,Target_Species,Plot_Name,Start_Date,Spp_Name,Count)%>%
  pivot_wider(
    names_from = Spp_Name,
    values_from = Count,
    values_fill = 0
  )
motileInvert_counts_pivot<-motileInvert_counts_pivot%>%
  mutate(across(where(is.numeric), ~ ifelse(. < 0, 0, .)))

#Motile Invert Measurements Pivot
motileInvert_measurements_pivot<-motileInvert_measurements%>%
  select(Site_Name,Loc_Name,Target_Species,Plot_Name,Start_Date,Spp_Name,Measurement)%>%
  pivot_wider(
    names_from = Spp_Name,
    values_from = Measurement,
    values_fn = mean,
    values_fill = 0
  )
names(motileInvert_measurements_pivot)[(ncol(motileInvert_measurements_pivot)-5):ncol(motileInvert_measurements_pivot)] <- paste0(names(motileInvert_measurements_pivot)[(ncol(motileInvert_measurements_pivot)-5):ncol(motileInvert_measurements_pivot)], " Mean Measure")
```

# Feature Selection
```{r}
models <- list(
  asco_oob = oob_asco,
  asco_rf  = rf_asco,
  fuc_oob  = oob_fuc,
  fuc_rf   = rf_fuc
)

importance_vals <- lapply(models, importance)

# selecting variables that, when removed, do not increase the mean squared error. Variables with a value above 0 represent variables that are helping the model reduce error by being present.
unimportant_vars <- union(
  rownames(filter(importance_vals$asco_oob, `%IncMSE` <= 0)),
  rownames(filter(importance_vals$fuc_oob,  `%IncMSE` <= 0))
)
```

